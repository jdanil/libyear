import { expect, it } from "@jest/globals";
import { transformStdOut } from "../release-time-logic";

it('return expected data with latest field', () => {
  const input = `{
    "time": {
      "modified": "2022-08-15T08:26:57.751Z",
      "created": "2016-05-17T04:44:38.418Z",
      "0.0.16-alpha": "2016-05-17T04:44:38.418Z",
      "0.0.17-alpha": "2016-05-19T20:38:22.233Z",
      "0.0.22-alpha": "2016-05-20T19:25:49.583Z",
      "0.0.23-alpha": "2016-05-25T04:44:14.555Z",
      "0.0.24-alpha": "2016-07-01T19:13:25.619Z",
      "0.0.25-alpha": "2016-07-01T22:33:40.534Z",
      "0.0.26-alpha": "2016-07-02T02:12:23.359Z",
      "0.0.27-alpha": "2016-07-04T00:02:00.343Z",
      "0.0.28-alpha": "2016-07-08T19:53:42.912Z",
      "0.0.29": "2016-07-14T14:18:12.811Z",
      "0.0.30": "2016-09-19T16:36:36.593Z",
      "1.0.0": "2017-04-21T16:00:58.437Z",
      "3.0.0": "2018-10-16T16:30:45.494Z",
      "1.2.0": "2018-12-03T17:08:33.100Z",
      "1.2.1": "2021-09-21T02:02:01.268Z"
    },
    "versions": [
      "0.0.16-alpha",
      "0.0.17-alpha",
      "0.0.22-alpha",
      "0.0.23-alpha",
      "0.0.24-alpha",
      "0.0.25-alpha",
      "0.0.26-alpha",
      "0.0.27-alpha",
      "0.0.28-alpha",
      "0.0.29",
      "0.0.30",
      "1.0.0",
      "1.2.0",
      "1.2.1",
      "3.0.0"
    ],
    "version": "1.2.1"
  }`

  const result = transformStdOut(input, "npm");

  expect(result).toStrictEqual({
    versionsMap: {
      "0.0.16-alpha": "2016-05-17T04:44:38.418Z",
      "0.0.17-alpha": "2016-05-19T20:38:22.233Z",
      "0.0.22-alpha": "2016-05-20T19:25:49.583Z",
      "0.0.23-alpha": "2016-05-25T04:44:14.555Z",
      "0.0.24-alpha": "2016-07-01T19:13:25.619Z",
      "0.0.25-alpha": "2016-07-01T22:33:40.534Z",
      "0.0.26-alpha": "2016-07-02T02:12:23.359Z",
      "0.0.27-alpha": "2016-07-04T00:02:00.343Z",
      "0.0.28-alpha": "2016-07-08T19:53:42.912Z",
      "0.0.29": "2016-07-14T14:18:12.811Z",
      "0.0.30": "2016-09-19T16:36:36.593Z",
      "1.0.0": "2017-04-21T16:00:58.437Z",
      "1.2.0": "2018-12-03T17:08:33.100Z",
      "1.2.1": "2021-09-21T02:02:01.268Z",
      "3.0.0": "2018-10-16T16:30:45.494Z",
    },
    latest: "1.2.1"
  })
})
